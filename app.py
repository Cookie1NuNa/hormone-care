import streamlit as st
import datetime
import os

# --- 1. ê¸°ë³¸ ì„¤ì • ë° í•¨ìˆ˜ ---
DB_FILE = "last_period.txt"

def save_date(date_str):
    with open(DB_FILE, "w", encoding="utf-8") as f:
        f.write(date_str)

def load_date():
    if os.path.exists(DB_FILE):
        with open(DB_FILE, "r", encoding="utf-8") as f:
            return f.read().strip()
    return None

def make_routine(steps):
    return " â¡ï¸ ".join(steps)

def calculate_cycle_day(start_date_str):
    try:
        start_date = datetime.datetime.strptime(start_date_str, "%Y-%m-%d").date()
        today = datetime.date.today()
        delta = today - start_date
        return (delta.days % 28) + 1
    except:
        return None

# --- 2. [í•µì‹¬] ë‚´ ëª¸ ì£¼ì‹íšŒì‚¬ ê°€ì´ë“œ (í’€ ë²„ì „) ---
def display_hormone_guide(day):
    st.divider()
    st.markdown(f"#### ğŸ§¸ í˜¸ë¥´ëª¬ ê´€ë¦¬ & í”¼ë¶€ ë£¨í‹´ ì²´í¬: **Day {day}**")
    st.caption("""
               ìš°ë¦¬ ëª¸ì€ ë§¤ë‹¬ 'ì„ì‹ 'ì´ë¼ëŠ” ê±°ëŒ€í•œ í”„ë¡œì íŠ¸ë¥¼ ì„±ê³µì‹œí‚¤ê¸° ìœ„í•´ ë¶€ì„œë³„ë¡œ ì°©ì°© ì›€ì§ì´ëŠ” ì‹œìŠ¤í…œê³¼ ê°™ë‹¤.
                í”„ë¡œì íŠ¸ê°€ ì—ì–´ì§€ë©´(ì„ì‹  ì‹¤íŒ¨), ê°€ì°¨ ì—†ì´ êµ¬ì¡°ì¡°ì •(ìƒë¦¬) ë“¤ì–´ê°€ëŠ” ëƒ‰ì •í•œ ì„¸ê³„ì´ë‹¤.
                #íë¦„ì—ì €í•­í•˜ì§€ì•Šê¸° #í”¼ë¶€ë„íƒ€ì´ë° #ìì±…ê¸ˆì§€
""")
    
    
    # [í†µí•©ìš”ì•½]
    with st.expander(" â¬‡ï¸ë¯¸ë¦¬ ì•Œì•„ë³´ê¸°(ìš”ì•½) (Click)"):
        st.markdown("""
        ğŸ“‰ ìƒë¦¬ê¸°(1~5ì¼/FSH): "íŒŒì—… & ë¦¬ì…‹ ì¤‘"ì´ë‹ˆ í”¼ë¶€ì—” ìˆœí•œ ìˆ˜ë¶„ë§Œ, ëª¸ì€ ë”°ëœ»í•˜ê²Œ íœ´ì‹í•˜ì„¸ìš”.

        ğŸ“ˆ ë‚œí¬ê¸°(6~13ì¼/ì—ìŠ¤íŠ¸ë¡œê²): "ì—­ëŒ€ê¸‰ í™©ê¸ˆê¸°!" ê³ ê¸°ëŠ¥ì„± í™”ì¥í’ˆ, ì‹œìˆ , ë‹¤ì´ì–´íŠ¸ ì „ëŸ‰ íˆ¬ì…í•˜ì„¸ìš”. âœ¨

        ğŸš© ë°°ë€ê¸°(14~16ì¼/LH): "í™”ë ¤í•œ íŒŒí‹° & í”¼ì§€ ê²½ë³´!" ë§¤ë ¥ì€ ìµœê³ ì¡°ì§€ë§Œ, ê°œê¸°ë¦„ ì¡ì•„ì•¼ í•©ë‹ˆë‹¤.

        ğŸ›¡ï¸ í™©ì²´ê¸°(17~28ì¼/í”„ë¡œê²ŒìŠ¤í…Œë¡ ): "ì² í†µ ë³´ì•ˆ & ì¡´ë²„!" ìì™¸ì„ ì°¨ë‹¨ í•„ìˆ˜, íŠ¸ëŸ¬ë¸” ë†”ë‘ê³ , ì¤‘ìš”í•œ ê²°ì •ì€ ë¯¸ë£¨ì„¸ìš”.

        """)

    # --- êµ¬ê°„ë³„ ìŠ¤í† ë¦¬í…”ë§ ì‹œì‘ ---

    # 1. ìƒë¦¬ê¸° (Day 1 ~ 5)
    if 1 <= day <= 5:
        st.error(f"### ğŸ©¸ 1. ìƒë¦¬ê¸°: êµ¬ì¡°ì¡°ì • ë° ì‚¬ë¬´ì‹¤ ëŒ€ì²­ì†Œ (Day {day})")
        st.caption("â›‘ï¸ FSH(ì¸ì‚¬íŒ€ì¥): 'êµ¬ì¡°ì¡°ì • ë° ë‚´ë¶€ ìˆ˜ë¦¬ ì¤‘ (ì…§ë‹¤ìš´)'")
        
        if day <= 2:
            st.markdown("#### ğŸš¨ 1ë‹¨ê³„: í­í’ì˜ ì‹œì‘ (Day 1~2)")
            st.info("""
            **ğŸ¢ íšŒì‚¬ ìƒí™©: "ê¸´ê¸‰ ë¹„ìƒì‚¬íƒœ & ì² ê±°ë°˜ íˆ¬ì…"**
            í˜¸ë¥´ëª¬ ìˆ˜ì¹˜ê°€ ë°”ë‹¥ì„ ì°ê³ , ìê¶ ë‚´ë§‰ì„ í—ˆë¬¼ì–´ ëœ¨ë¦¬ëŠ” 'í”„ë¡œìŠ¤íƒ€ê¸€ë€ë”˜(í†µì¦ ìœ ë°œ ë¬¼ì§ˆ)'ì´ë¼ëŠ” ì² ê±°ë°˜ì´ ë‚œë™ì„ ë¶€ë¦½ë‹ˆë‹¤.
            í˜¸ë¥´ëª¬ ì„ì›ë“¤ì´ ë‹¤ í‡´ê·¼í•´ì„œ ì§€ì›ê¸ˆ(ì˜ì–‘)ì´ ëŠê²¼ìŠµë‹ˆë‹¤.
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ì „ëµ] "ì´ˆë¯¼ê° ìƒíƒœ! ì•„ë¬´ê²ƒë„ í•˜ì§€ ë§ˆ!"**
            * í”¼ë¶€ ìƒíƒœ: ë°©ì–´ë§‰ì´ ì™„ì „íˆ ë¬´ë„ˆì ¸ì„œ ê±°ì¹ ê³  ì¹™ì¹™í•©ë‹ˆë‹¤. ë‹¤í¬ì„œí´ì´ ì‹¬í•´ì§‘ë‹ˆë‹¤.
            """)
            col1, col2 = st.columns(2)
            with col1:
                st.success("**âœ… Do:**\n* **ë¬¼ ì£¼ê¸°:** í”¼ë¶€ê°€ ì‚¬ë§‰ì…ë‹ˆë‹¤. ìˆœí•œ ìˆ˜ë¶„ í¬ë¦¼ë§Œ ë§ë°œë¼ì£¼ì„¸ìš”.\n* **ì˜¨ì—´ íŒ©:** ë°°ë¥¼ ë”°ëœ»í•˜ê²Œ í•´ì•¼ í˜ˆìƒ‰ì´ ëŒì•„ì˜µë‹ˆë‹¤.")
            with col2:
                st.error("**âŒ Don't:**\n* **ê¸°ëŠ¥ì„± í™”ì¥í’ˆ ê¸ˆì§€:** ë…í•œ ì„±ë¶„ì€ ë…ì´ ë©ë‹ˆë‹¤.\n* **ìƒˆ í™”ì¥í’ˆ í…ŒìŠ¤íŠ¸ ê¸ˆì§€:** 100% íŠ¸ëŸ¬ë¸” ë‚©ë‹ˆë‹¤.")
            
            st.write("---")
            st.write(f"â˜€ï¸ ì•„ì¹¨: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'í”„ë¦¬ë©”ì´í¬ë¦¼', 'ì¬í¬ë¦¼'])}")
            st.write(f"ğŸŒ™ ì €ë…: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'ë§ˆë°ì¹´+ì‹œì¹´'])}")
            
        elif day <= 4:
            st.markdown("#### ğŸ§¹ 2ë‹¨ê³„: ì”í•´ ì •ë¦¬ & ì†Œê°•ìƒíƒœ (Day 3~4)")
            st.info("""
            **ğŸ¢ íšŒì‚¬ ìƒí™©: "ì² ê±° ì‘ì—… ì¢…ë£Œ, ì²­ì†Œ ì¤‘"**
            ê²©ë ¬í–ˆë˜ ì² ê±°(ì¶œí˜ˆ)ê°€ ì¤„ì–´ë“¤ê³ , í˜¸ë¥´ëª¬ ë°”ë‹¥ ìƒíƒœì— ì ì‘í•˜ë©° ì•ˆì •ì„ ì°¾ì•„ê°€ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ì „ëµ] "ìˆ˜ë¶„ ì‹¬íì†Œìƒìˆ "**
            * í”¼ë¶€ ìƒíƒœ: íŠ¸ëŸ¬ë¸”ì€ ê°€ë¼ì•‰ì•˜ì§€ë§Œ, í‘¸ì„í‘¸ì„í•¨ì´ ìµœê³ ì¡°ì…ë‹ˆë‹¤. í™”ì¥ì´ ë– ì„œ ë°€ë¦½ë‹ˆë‹¤.
            """)
            st.success("**âœ… Do (ìˆ˜ë¶„ í­íƒ„ íŒ©):** ìê·¹ ì—†ëŠ” ìˆ˜ë¶„ ì‹œíŠ¸íŒ©ì„ í•´ì£¼ì„¸ìš”.")
            st.error("**âŒ Don't (ê°ì§ˆ ì œê±° ê¸ˆì§€):** í™”ì¥ ëœ¬ë‹¤ê³  ê°ì§ˆ ë°€ë©´ ì•ˆ ë©ë‹ˆë‹¤. ì•„ì§ í”¼ë¶€ê°€ ì–‡ê³  ì•½í•´ìš”.")
            
            st.write("---")
            st.write(f"ğŸŒ™ ì €ë…: {make_routine(['í† ë„ˆ', 'ë§ˆìŠ¤í¬íŒ©(ìˆ˜ë¶„)', 'íˆì•Œë£¨ë¡ ì‚°', 'ë§ˆë°ì¹´+ì‹œì¹´(ë“¬ë¿)'])}")
            
        else: # Day 5
            st.markdown("#### ğŸŒ± 3ë‹¨ê³„: ì˜ì—… ì¬ê°œ ì¤€ë¹„ (Day 5)")
            st.info("""
            **ğŸ¢ íšŒì‚¬ ìƒí™©: "ì‹ ì… ì‚¬ì›(ë‚œí¬) ë©´ì ‘ ì¤€ë¹„ & ì—ìŠ¤íŠ¸ë¡œê² ì¶œê·¼!"**
            ìƒë¦¬ê°€ ê±°ì˜ ëë‚˜ê°€ë©´ì„œ, **ì—ìŠ¤íŠ¸ë¡œê²(í™ë³´íŒ€ì¥)**ì´ ë‹¤ì‹œ ì¶œê·¼ ê°€ë°©ì„ ìŒ‰ë‹ˆë‹¤. ëª¸ì´ ê°€ë²¼ì›Œì§€ëŠ” ê²Œ ëŠê»´ì§‘ë‹ˆë‹¤.
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ì „ëµ] "ê´‘ë‚¼ ì¤€ë¹„ ì™„ë£Œ (ê°ì§ˆ ì •ë¦¬)"**
            * í”¼ë¶€ ìƒíƒœ: í˜ˆìƒ‰ì´ ëŒì•„ì˜¤ê³  í”¼ë¶€ ê²°ì´ ë§¤ë„ëŸ¬ì›Œì§€ê¸° ì‹œì‘í•©ë‹ˆë‹¤.
            """)
            st.success("""
            **âœ… Do:**
            * **ì•½í•œ ê°ì§ˆ ì •ë¦¬:** ë‚´ì¼ë¶€í„° ì¢‹ì€ í™”ì¥í’ˆì„ í¡ìˆ˜ì‹œí‚¤ê¸° ìœ„í•´ ë¬µì€ ê°ì§ˆì„ ì‚´ì‚´ ê±·ì–´ë‚´ì„¸ìš” (íš¨ì†Œ ì„¸ì•ˆì œ).
            * **ë¯¸ë°± ê´€ë¦¬ ì‹œì‘:** ë¹„íƒ€ë¯¼C ì•°í”Œ ë“±ì„ ìŠ¬ìŠ¬ êº¼ë‚´ì…”ë„ ë©ë‹ˆë‹¤.
            """)
            st.write("---")
            st.write(f"ğŸŒ™ ì €ë…: {make_routine(['ğŸ“íš¨ì†ŒíŒŒìš°ë”', 'í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'í¬ë¦¼'])}")

    # 2. ë‚œí¬ê¸° (Day 6 ~ 13)
    elif 6 <= day <= 13:
        st.success(f"### ğŸ“ˆ 2. ë‚œí¬ê¸°: ê³µê²©ì  íˆ¬ì & ë¦¬ì¦ˆ ì‹œì ˆ ê°±ì‹  (Day {day})")
        st.caption("âœ¨ ì—ìŠ¤íŠ¸ë¡œê²(í™ë³´ì´ì‚¬): 'ë¬¼ ë“¤ì–´ì˜¬ ë•Œ ë…¸ ì €ì–´! ì˜ˆì‚° ë¬´ì œí•œ ìŠ¹ì¸!'")
        
        st.info("""
        **ğŸ¢ íšŒì‚¬ ìƒí™©: "ì°½ì‚¬ ì´ë˜ ìµœê³  ì‹¤ì !"**
        í™ë³´íŒ€(ì—ìŠ¤íŠ¸ë¡œê²)ì´ ì—´ì¼í•˜ë©° CEO(ë‚˜)ì˜ ë¯¸ëª¨ë¥¼ ì „ì‚¬ì ìœ¼ë¡œ ë°€ì–´ì£¼ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. 
        íšŒë³µë ¥, í¡ìˆ˜ë ¥ì´ ìµœê³ ì¡°ë¼ ë­˜ ë°œë¼ë„ íš¨ê³¼ê°€ 200% ë‚˜ì˜µë‹ˆë‹¤.
        """)

        # ì¼ìë³„ ìƒì„¸ ë£¨í‹´ (Day 6~9)
        if day == 6:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ë¯¸ë°± & ì¥ë¹„ í’€ê°€ë™ - Day 6 (ì¡°ëª…íŒ ì„¤ì¹˜)")
            st.write("**ëª©í‘œ:** [í•­ì‚°í™” + ìˆ˜ë¶„ ë°€í] ì¡°í•©. ì¡í‹°/í†¤ì—… ê³µê²©!")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'ğŸ“ë¹„íƒ€ë¯¼C ì•°í”Œ(ğŸ‹)', 'ë§ˆìŠ¤í¬íŒ©(ìˆ˜ë¶„)', 'ë§ˆë°ì¹´+ì‹œì¹´'])}")
            
        elif day == 7:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ë¯¸ë°± & ì¥ë¹„ í’€ê°€ë™ - Day 7 (ê¹Šìˆ™ì´ ì¹¨íˆ¬)")
            st.write("**ëª©í‘œ:** ê¸°ê¸°ë¥¼ ì¨ì„œ ìœ íš¨ ì„±ë¶„ì„ í”¼ë¶€ ê¹Šìˆ™ì´ ì°”ëŸ¬ ë„£ì–´ì£¼ëŠ” ë‚ ì…ë‹ˆë‹¤.")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°(ë² ì´ìŠ¤)', 'ğŸ“ì´ˆìŒíŒŒê¸°ê¸° + ì•ŒíŒŒì•Œë¶€í‹´', 'í¬ë¦¼'])}")
            
        elif day == 8:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ë¯¸ë°± & ì¥ë¹„ í’€ê°€ë™ - Day 8 (ë¦¬ëª¨ë¸ë§ ì‹œê³µ)")
            st.write("**ëª©í‘œ:** ë‹ˆë“¤ìƒ·ìœ¼ë¡œ ê¸¸ ëš«ê¸°! íšŒë³µë ¥ì´ ì¢‹ì•„ì„œ ë‹ˆë“¤ìƒ· ì“°ê¸° ì œì¼ ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤.")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ğŸ“ë‹ˆë“¤ìƒ·(ë§¨ì–¼êµ´)', 'í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°(ê¸‰ì†ì¶©ì „)', 'ì¬ìƒí¬ë¦¼/ì‹œì¹´'])}")
            st.error("âš ï¸ ì£¼ì˜: ë‹ˆë“¤ìƒ· í•œ ë‚ ì€ ë¹„íƒ€ë¯¼Cë‚˜ ë ˆí‹°ë†€ ê¸ˆì§€! ìˆ˜ë¶„/ì¬ìƒ ìœ„ì£¼ë¡œ!")
            
        elif day == 9:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ë¯¸ë°± & ì¥ë¹„ í’€ê°€ë™ - Day 9 (ê²° ì •ë¦¬ & ëª¨ê³µ ë‹¨ì†)")
            st.write("**ëª©í‘œ:** ë‹ˆë“¤ìƒ· ë‹¤ìŒ ë‚  ê²° ì •ë¦¬. ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œë¡œ ë¯¸ë°±ê³¼ ëª¨ê³µ ë™ì‹œì— ì¡ê¸°.")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'ğŸ“ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ', 'í¬ë¦¼'])}")
            
        else: # Day 10~13
            st.markdown("#### âœ¨ 2ë‹¨ê³„: ìµœì „ì„±ê¸° ìœ ì§€ & ìˆ˜ë¶„ ê´‘ì±„ (Day 10~13)")
            st.write("**ğŸ‘‰ ì»¨ì…‰:** 'ë¬¼ê´‘ ì½”íŒ… & ë°°ë€ê¸°(ê°œê¸°ë¦„) ëŒ€ë¹„'")
            st.write("ì´ì œ ë¯¸ë°± ê³µê²©ì€ ì¶©ë¶„íˆ í–ˆìœ¼ë‹ˆ, ìœ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶°ì„œ 'ì›ë˜ í”¼ë¶€ ì¢‹ì€ ì‚¬ëŒ'ì²˜ëŸ¼ ë³´ì´ê²Œ ë§Œë“œì„¸ìš”.")
            st.success("""
            **ğŸ’¡ Tip:**
            * **íˆì•Œë£¨ë¡ ì‚° ë¨¼ì €:** íŒ© ë¶™ì´ê¸° ì „ì— ì•°í”Œì„ ë¨¼ì € ê¹”ì•„ì£¼ì„¸ìš”. í¡ìˆ˜ìœ¨ì´ í­ë°œí•©ë‹ˆë‹¤.
            * **í¬ë¦¼ì€ ì–‡ê²Œ:** 13ì¼ì¯¤ ë˜ë©´ í”¼ì§€ê°€ ì˜¬ë¼ì˜¤ë‹ˆ í¬ë¦¼ ì–‘ì„ ì¤„ì´ì„¸ìš”.
            """)
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'ğŸ’§íˆì•Œë£¨ë¡ ì‚°(íŒ© ì „)', 'ğŸ§–â€â™€ï¸ìˆ˜ë¶„ ë§ˆìŠ¤í¬íŒ©', 'ë§ˆë°ì¹´+ì‹œì¹´(ì–‡ê²Œ)'])}")

    # 3. ë°°ë€ê¸° & ì²´ì œ ì „í™˜ (Day 14 ~ 16)
    elif 14 <= day <= 16:
        st.warning(f"### ğŸ‰ 3. ë°°ë€ê¸°: ì‹ ì œí’ˆ ëŸ°ì¹­ íŒŒí‹° & ëª¨ê³µ ë¹„ìƒëŒ€ì±…ìœ„ (Day {day})")
        
        if day == 14:
            st.caption("ğŸ‰ LH(ì´ë²¤íŠ¸ íŒ€ì¥): '3, 2, 1... í­ì£½ ë°œì‚¬!'")
            st.info("""
            **ğŸ¢ íšŒì‚¬ ìƒí™©: "ì „ ì§ì› í¥ë¶„ ìƒíƒœ! íŒŒí‹°ëŠ” ì¦ê²ì§€ë§Œ ì²­ì†ŒëŠ” í˜ë“¤ë‹¤"**
            ì´ë²¤íŠ¸ íŒ€ì¥ì´ í­ì£½ì„ í„°ëœ¨ë¦¬ë©° ë¶„ìœ„ê¸°ê°€ ìµœê³ ì¡°ì— ë‹¬í•©ë‹ˆë‹¤. 
            í•˜ì§€ë§Œ í­ì£½ ì—°ê¸°ì™€ ê°€ë£¨(í”¼ì§€ ë¶„ë¹„ëŸ‰ ê¸‰ì¦)ê°€ í”¼ë¶€ë¥¼ ë®ì¹˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ê²‰ë³´ê¸°ì—” ë²ˆì©ë²ˆì©í•œë°, ëª¨ê³µ ì†ì€ ë¹„ìƒì…ë‹ˆë‹¤.
            """)
            st.markdown("#### ğŸš¨ í•µì‹¬ ë¯¸ì…˜: ê°œê¸°ë¦„(Sebum)ê³¼ì˜ ì „ìŸ & ëª¨ê³µ ëŒ€ì²­ì†Œ")
            st.write("**ğŸ‘‰ ì»¨ì…‰:** ì˜ì–‘ ê³µê¸‰ë³´ë‹¤ëŠ” **'ë¹„ì›€'**ì´ ì¤‘ìš”í•œ ë‚ ì…ë‹ˆë‹¤.")
            
            col1, col2 = st.columns(2)
            with col1:
                st.success("""
                **âœ… Do:**
                * **ë”¥ í´ë Œì§•:** ì½” ì£¼ë³€, í„± ë°‘ í”¼ì§€ ë…¹ì—¬ë‚´ê¸°
                * **ì¿¨ë§/ë¨¸ë“œíŒ©:** í”¼ì§€ í¡ì°© ë° ì—´ ë‚´ë¦¬ê¸°
                * **ìˆ˜ë¶„ ì ¤:** ì‚°ëœ»í•œ ë§ˆë¬´ë¦¬
                """)
            with col2:
                st.error("""
                **âŒ Don't:**
                * **ìœ ë¶„ ê³µê¸‰ ì¤‘ë‹¨:** í˜ì´ìŠ¤ ì˜¤ì¼, ë¦¬ì¹˜í•œ í¬ë¦¼ ê¸ˆì§€
                * **ì§œì§€ ë§ˆì„¸ìš”:** ìêµ­ ì˜¤ë˜ ë‚¨ìŠµë‹ˆë‹¤.
                * **ë°±í™”ì  ê¸ˆì§€:** ì¶©ë™êµ¬ë§¤ í™•ë¥  200%
                * **í­ì‹ ì£¼ì˜:** ì•¼ì‹ ë‹¹ê¸°ëŠ” ë‚ 
                """)
            st.write("---")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ì˜¤ì¼í´ë Œì§•/íš¨ì†ŒíŒŒìš°ë”', 'ë‹¥í† (ë‹¦ëŠ”í† ë„ˆ)', 'ğŸ§Šëª¨ë¸ë§/ë¨¸ë“œíŒ©', 'ìˆ˜ë¶„ì ¤í¬ë¦¼'])}")
            
        else: # Day 15~16
            st.caption("ğŸ§¹ ë’¤í’€ì´ & ì²´ì œ ì „í™˜ (ì—´ ì‹íˆê¸°)")
            st.info("""
            **ğŸ¢ íšŒì‚¬ ìƒí™©: "ì—´ ì‹íˆê¸° & ë³´ì•ˆ ëª¨ë“œ ì§„ì…"**
            ë°°ë€ì´ ëë‚˜ìë§ˆì **í”„ë¡œê²ŒìŠ¤í…Œë¡ (ë³´ì•ˆíŒ€ì¥)**ì´ ì¶œê·¼í•©ë‹ˆë‹¤.
            ê°€ì¥ í° ë³€í™”ëŠ” **'ì²´ì˜¨ ìƒìŠ¹'**ì…ë‹ˆë‹¤. ëª¨ê³µì´ ì—´ë¦° ì±„ë¡œ í”¼ì§€ê°€ êµ³ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            """)
            st.success("""
            **âœ… Do:**
            * **ì¿¨ë§(Cooling):** í”¼ë¶€ ì˜¨ë„ ë‚®ì¶”ê¸° 1ìˆœìœ„ (ì•Œë¡œì— ì ¤, ì¿¨ë§ ìŠ¤í‹±)
            * **ì§„ì •(Calming):** ì‹œì¹´, í‹°íŠ¸ë¦¬, ì–´ì„±ì´ˆ ì†Œí™˜
            """)
            st.write("---")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ì°¨ê°€ìš´ í† ë„ˆ', 'ìˆ˜ë¶„ ì•°í”Œ', 'ì•Œë¡œì— ì ¤(ë‘ê»ê²Œ)', 'ì‹œì¹´ í¬ë¦¼'])}")

    # 4. í™©ì²´ê¸° (Day 17 ~ 28)
    else:
        st.info(f"### ğŸ›¡ï¸ 4. í™©ì²´ê¸°: ì² í†µ ë³´ì•ˆ & ë¹„ìƒì‚¬íƒœ (PMS) (Day {day})")
        st.caption("ğŸ‘®â€â™‚ï¸ í”„ë¡œê²ŒìŠ¤í…Œë¡ (ë³´ì•ˆíŒ€ì¥): 'ì°½ê³ ì— ë¬¼ì ë¹„ì¶• ì¤‘ (ë¶€ì¢… & ì‹ìš•)'")
        
        st.markdown("""
        **ğŸ¢ íšŒì‚¬ ìƒí™©:** ë³´ì•ˆíŒ€ì¥ì´ ë¬¼ê³¼ ì§€ë°©ì„ ëª¸ì— ê°€ë‘ê³  ìˆìŠµë‹ˆë‹¤. ëª¸ë¬´ê²Œê°€ 1~2kg ëŠ˜ì–´ë‚  ìˆ˜ ìˆëŠ”ë°, ì´ê±´ ì§€ë°©ì´ ì•„ë‹ˆë¼ **ìˆ˜ë¶„(ë¶“ê¸°)**ì…ë‹ˆë‹¤.
        """)
        st.success("""
        **âœ… Do & Don't:**
        * **ì €ì—¼ì‹:** ì§  ê±° ë¨¹ìœ¼ë©´ ë°”ë¡œ ë¶“ìŠµë‹ˆë‹¤. êµ­ë¬¼ ìš”ë¦¬ í”¼í•˜ì„¸ìš”.
        * **ìˆœí™˜ ìš´ë™:** ë¦¼í”„ ë§ˆì‚¬ì§€, ìš”ê°€, ìŠ¤íŠ¸ë ˆì¹­.
        * **ëª¸ë¬´ê²Œ ì¬ì§€ ë§ˆì„¸ìš”:** ì´ë•Œ ì° ê±´ 'í˜¸ë¥´ëª¬ ë¬´ê²Œ'ì…ë‹ˆë‹¤.
        * **ì¤‘ìš”í•œ ê²°ì • ê¸ˆì§€:** í‡´ì‚¬, ì´ë³„, ì•ë¨¸ë¦¬ ìë¥´ê¸° ë“±ì€ ë‹¤ìŒ ì£¼ ë‚œí¬ê¸°ë¡œ ë¯¸ë£¨ì„¸ìš”. **ì§€ê¸ˆ ë‚´ ê¸°ë¶„ì€ ê°€ì§œì…ë‹ˆë‹¤.**
        """)

        if day <= 22:
            st.markdown("#### ğŸ§± 1ë‹¨ê³„: í™©ì²´ê¸° ì „ê¸° - ë°©ì–´ ëª¨ë“œ (Day 17~22)")
            st.write("**ğŸ‘‰ ì»¨ì…‰: í–‡ë¹›ê³¼ì˜ ì „ìŸ (ê¸°ë¯¸ ì°¨ë‹¨)**")
            st.write("ë©œë¼ë‹Œ ì„¸í¬ê°€ í™œë°œí•´ì ¸ì„œ ê¸°ë¯¸/ì£¼ê·¼ê¹¨ê°€ ìƒê¸°ê¸° ë”± ì¢‹ì€ ì‹œê¸°ì…ë‹ˆë‹¤.")
            st.warning("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ì „ëµ]**
            * **ìì™¸ì„  ì°¨ë‹¨ì œ í•„ìˆ˜:** í‰ì†Œë³´ë‹¤ ë‘ê»ê²Œ! ì–‘ì‚°/ëª¨ì ì¶”ì²œ.
            * **í´ë ˆì´ íŒ©:** ì£¼ 1~2íšŒ í”¼ì§€ í¡ì°©.
            """)
            st.write("---")
            st.info(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'ì§„ì • ì•°í”Œ', 'ìˆ˜ë¶„ í¬ë¦¼', 'ëª¨ë¸ë§íŒ©(ì„ íƒ)'])}")
            
        else: # Day 23~28
            st.markdown("#### ğŸš¨ 2ë‹¨ê³„: í™©ì²´ê¸° í›„ê¸° - í­ë™ ì „ì•¼ PMS (Day 23~28)")
            st.error("""
            **ğŸ¢ íšŒì‚¬ ìƒí™©: "ì„ì›ì§„ ì „ì› ì‚¬í‡´ & ë¹„ìƒê²½ì˜ (PMS)"**
            ì„ì‹ ì´ ì•„ë‹ˆë¼ëŠ” ì†Œì‹ì— í˜¸ë¥´ëª¬ì´ ê¸‰ê²©íˆ ì¤„ì–´ë“­ë‹ˆë‹¤(í‡´ì‚¬).
            "ì•¼! ë‹¤ ë§í–ˆì–´! ì² ìˆ˜í•´!" ë‡Œì—ì„œëŠ” í–‰ë³µ í˜¸ë¥´ëª¬(ì„¸ë¡œí† ë‹Œ)ì´ ì¤„ì–´ë“¤ì–´ ì§œì¦ê³¼ ìš°ìš¸ì´ ë°€ë ¤ì˜µë‹ˆë‹¤.
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ì „ëµ] "ì ‘ê·¼ ê¸ˆì§€ (Touch NO) & ì§„ì • ì˜¬ì¸"**
            * í„±, ì… ì£¼ë³€(Uì¡´)ì— í™”ë†ì„± ì—¬ë“œë¦„ì´ ì˜¬ë¼ì˜µë‹ˆë‹¤. **ì•ˆ ê±´ë“œë¦¬ëŠ” ê²Œ ìµœê³ ì˜ ê´€ë¦¬**ì…ë‹ˆë‹¤.
            """)
            st.success("""
            **âœ… Do:**
            * **ìµœì†Œí•œì˜ ë£¨í‹´:** í™”ì¥í’ˆ ê°œìˆ˜ë¥¼ í™• ì¤„ì´ì„¸ìš”.
            * **íŠ¸ëŸ¬ë¸” íŒ¨ì¹˜:** ë¶‰ê²Œ ì˜¬ë¼ì˜¤ë©´ ë°”ë¡œ ë¶™ì´ê³  ì†ëŒ€ì§€ ë§ˆì„¸ìš”.
            * **ì§„ì • íŒ©:** ì‹œì¹´, ì‘¥, ì•Œë¡œì—.
            """)
            st.write("---")
            st.info(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ì•½ì‚°ì„± ì„¸ì•ˆ', 'í† ë„ˆ', 'ì‹œì¹´ í¬ë¦¼(í•˜ë‚˜ë§Œ)', 'íŠ¸ëŸ¬ë¸”íŒ¨ì¹˜'])}")

    # ê³µí†µ í•˜ë‹¨ ë©”ì‹œì§€
    st.divider()
    st.caption("ğŸ’ª ì˜¤ëŠ˜ë„ ë‚´ ëª¸ ì£¼ì‹íšŒì‚¬ì˜ CEOë¡œì„œ íŒŒì´íŒ…í•˜ì„¸ìš”!")

# --- 3. ë©”ì¸ ì‹¤í–‰ í™”ë©´ ---
st.header("ğŸ“‘ ë‚´ ëª¸ ê²½ì˜ ì „ëµ ë³´ê³ ì„œ")

saved_date = load_date()

# ì‚¬ì´ë“œë°” ì„¤ì •
with st.sidebar:
    st.header("âš™ï¸ CEO ì§‘ë¬´ì‹¤ (ì„¤ì •)")
    if saved_date:
        st.write(f"ğŸ“… ë§ˆì§€ë§‰ êµ¬ì¡°ì¡°ì •ì¼(ìƒë¦¬): `{saved_date}`")
    
    new_date = st.date_input("ë‚ ì§œ ì •ì •í•˜ê¸°", 
                             value=datetime.datetime.strptime(saved_date, "%Y-%m-%d").date() if saved_date else datetime.date.today())
    
    if st.button("ê²°ì¬(ì €ì¥)"):
        save_date(str(new_date))
        st.success("ìŠ¹ì¸ ì™„ë£Œ! ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.")
        st.rerun()

# ë©”ì¸ ë¡œì§ ì‹¤í–‰
if saved_date:
    current_day = calculate_cycle_day(saved_date)
    if current_day:
        display_hormone_guide(current_day)
    else:
        st.error("ì‹œìŠ¤í…œ ì˜¤ë¥˜: ë‚ ì§œ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.")
else:
    st.warning("ğŸ‘ˆ ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ë§ˆì§€ë§‰ ìƒë¦¬ ì‹œì‘ì¼ì„ ê²°ì¬í•´ì£¼ì„¸ìš”.")