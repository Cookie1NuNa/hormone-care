import streamlit as st
import datetime
import os

# --- 1. ê¸°ë³¸ ì„¤ì • ë° í•¨ìˆ˜ ---
DB_FILE = "last_period.txt"

def save_date(date_str):
    with open(DB_FILE, "w", encoding="utf-8") as f:
        f.write(date_str)

def load_date():
    if os.path.exists(DB_FILE):
        with open(DB_FILE, "r", encoding="utf-8") as f:
            return f.read().strip()
    return None

def make_routine(steps):
    return " â¡ï¸ ".join(steps)

def calculate_cycle_day(start_date_str):
    try:
        start_date = datetime.datetime.strptime(start_date_str, "%Y-%m-%d").date()
        today = datetime.date.today()
        delta = today - start_date
        return (delta.days % 28) + 1
    except:
        return None

# --- 2. [í•µì‹¬] ë‚´ ëª¸ ì£¼ì‹íšŒì‚¬ ê°€ì´ë“œ (ì¹œì ˆí•œ ë²„ì „) ---
def display_hormone_guide(day):
    st.divider()
    st.markdown(f"#### ğŸ§¸ ì˜¤ëŠ˜ì˜ ë³´ê³ ì„œ: **Day {day}**")
    
    # [ì¹œì ˆí•œ ì•ˆë‚´] ì„¸ê³„ê´€ ì„¤ëª… (ì ‘ì—ˆë‹¤ íˆë‹¤ í•  ìˆ˜ ìˆê²Œ)
    with st.expander("â„¹ï¸ 'ë‚´ ëª¸ ì£¼ì‹íšŒì‚¬'ê°€ ë­”ê°€ìš”? (ì²˜ìŒ ì˜¤ì…¨ë‹¤ë©´ í•„ë…!)"):
        st.markdown("""
        **ìš°ë¦¬ ëª¸ì„ í•˜ë‚˜ì˜ 'íšŒì‚¬'ë¼ê³  ìƒìƒí•´ ë³´ì„¸ìš”!** ğŸ¢
        ë§¤ë‹¬ 'ì•„ê¸° ë§Œë“¤ê¸°'ë¼ëŠ” í”„ë¡œì íŠ¸ë¥¼ ìœ„í•´ ì§ì›(í˜¸ë¥´ëª¬)ë“¤ì´ ì—´ì‹¬íˆ ì¼í•˜ê³  ìˆì–´ìš”.
        
        * **ì¸ì‚¬íŒ€ì¥ (FSH):** ìƒë¦¬ ë•Œ ì ë“  ë‚œìë¥¼ ê¹¨ìš°ëŠ” **'ê¸°ìƒ ë‚˜íŒ”'** ğŸº
        * **í™ë³´ì´ì‚¬ (ì—ìŠ¤íŠ¸ë¡œê²):** ìƒë¦¬ í›„ í”¼ë¶€ì™€ ê¸°ë¶„ì„ ì¢‹ê²Œ ë§Œë“œëŠ” **'ë¯¸ëª¨ ë‹´ë‹¹'** âœ¨
        * **ì´ë²¤íŠ¸íŒ€ì¥ (LH):** ë°°ë€ì¼ì— ë‚œìë¥¼ ë‚´ë³´ë‚´ëŠ” **'í­ì£½ ë‹´ë‹¹'** ğŸ‰
        * **ë³´ì•ˆíŒ€ì¥ (í”„ë¡œê²ŒìŠ¤í…Œë¡ ):** ë°°ë€ í›„ ëª¸ì„ ë¶“ê²Œ í•˜ê³  ì§€í‚¤ëŠ” **'ë°©ì–´ ë‹´ë‹¹'** ğŸ›¡ï¸
        
        ì´ë“¤ì˜ ì¶œê·¼ ìŠ¤ì¼€ì¤„ì— ë§ì¶°ì„œ í”¼ë¶€ ê´€ë¦¬ì™€ ì»¨ë””ì…˜ ì¡°ì ˆì„ í•˜ë©´ í›¨ì”¬ íš¨ê³¼ì ì´ëë‹ˆë‹¤!
        """)

    # [í†µí•©ìš”ì•½]
    with st.expander(" â¬‡ï¸ ì´ë²ˆ ë‹¬ ìš”ì•½ ë¯¸ë¦¬ë³´ê¸° (Click)"):
        st.markdown("""
        * **ğŸ“‰ ìƒë¦¬ê¸° (1~5ì¼):** "íŒŒì—… & ëŒ€ì²­ì†Œ ì¤‘" â¡ï¸ í‘¹ ì‰¬ê³  ë¬¼ ë§ì´ ë“œì„¸ìš”.
        * **ğŸ“ˆ ë‚œí¬ê¸° (6~13ì¼):** "í™©ê¸ˆê¸° & ë¦¬ì¦ˆ ê°±ì‹ " â¡ï¸ ë‹¤ì´ì–´íŠ¸, ê³ ê¸°ëŠ¥ì„± í™”ì¥í’ˆ, ì‹œìˆ  OK! âœ¨
        * **ğŸš© ë°°ë€ê¸° (14~16ì¼):** "íŒŒí‹° & ê°œê¸°ë¦„ ì£¼ì˜" â¡ï¸ ë§¤ë ¥ì ì´ì§€ë§Œ í”¼ì§€ ì¡°ì‹¬í•˜ì„¸ìš”.
        * **ğŸ›¡ï¸ í™©ì²´ê¸° (17~28ì¼):** "ë°©ì–´ ëª¨ë“œ & ì¡´ë²„" â¡ï¸ ìì™¸ì„  ì°¨ë‹¨ í•„ìˆ˜, íŠ¸ëŸ¬ë¸” ì†ëŒ€ì§€ ë§ˆì„¸ìš”.
        """)

    # --- êµ¬ê°„ë³„ ìŠ¤í† ë¦¬í…”ë§ ì‹œì‘ ---

    # 1. ìƒë¦¬ê¸° (Day 1 ~ 5)
    if 1 <= day <= 5:
        st.error(f"### ğŸ©¸ 1. ìƒë¦¬ê¸°: ëŒ€ì²­ì†Œ & íœ´ì‹ ê¸°ê°„ (Day {day})")
        st.caption("ğŸ¢ í˜„ì¬ ìƒí™©: í˜¸ë¥´ëª¬ ì§ì›ë“¤ì´ ë‹¤ í‡´ê·¼í•˜ê³  ì²­ì†Œ(ìƒë¦¬) ì¤‘ì´ì—ìš”.")
        
        if day <= 2:
            st.markdown("#### ğŸš¨ 1ë‹¨ê³„: í­í’ì˜ ì‹œì‘ (Day 1~2)")
            st.info("""
            **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
            í˜¸ë¥´ëª¬ ìˆ˜ì¹˜ê°€ ë°”ë‹¥ì´ë¼ **ëª¸ë„ ê¸°ë¶„ë„ ì¶• ì²˜ì§€ëŠ” ë‚ **ì…ë‹ˆë‹¤.
            ë°°ê°€ ì•„í”„ê³  ê¹Œì¹ í•´ì§€ëŠ” ê±´ ë‹¹ì—°í•œ ê±°ë‹ˆê¹Œ, ìì±…í•˜ì§€ ë§ê³  í‘¹ ì‰¬ì„¸ìš”.
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ë³´ê³ ] "ì‚¬ì¥ë‹˜, ì§€ê¸ˆì€ ê±´ë“œë¦¬ë©´ ì•ˆ ë©ë‹ˆë‹¤!"**
            * í”¼ë¶€ ë°©ì–´ë§‰ì´ ì•½í•´ì ¸ì„œ ì—„ì²­ ì˜ˆë¯¼í•˜ê³  ê±´ì¡°í•´ìš”.
            """)
            col1, col2 = st.columns(2)
            with col1:
                st.success("**âœ… í•´ìš”:**\n* **ë¬¼ ì£¼ê¸°:** ìˆœí•œ ìˆ˜ë¶„ í¬ë¦¼ ë“¬ë¿!\n* **ì˜¨ì—´ íŒ©:** ë°°ë¥¼ ë”°ëœ»í•˜ê²Œ í•´ì£¼ì„¸ìš”.")
            with col2:
                st.error("**âŒ ë§ˆìš”:**\n* **ê¸°ëŠ¥ì„± í™”ì¥í’ˆ:** ë¹„íƒ€ë¯¼, ì£¼ë¦„ ê°œì„ ì œëŠ” ë”°ê°€ì›Œìš”.\n* **ìƒˆ í™”ì¥í’ˆ:** ì˜¤ëŠ˜ì€ ì°¸ìœ¼ì„¸ìš”.")
            
            st.write("---")
            st.write(f"â˜€ï¸ ì•„ì¹¨: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'í”„ë¦¬ë©”ì´í¬ë¦¼', 'ì¬í¬ë¦¼'])}")
            st.write(f"ğŸŒ™ ì €ë…: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'ë§ˆë°ì¹´+ì‹œì¹´(ì§„ì •)'])}")
            
        elif day <= 4:
            st.markdown("#### ğŸ§¹ 2ë‹¨ê³„: ì¡°ê¸ˆì”© ì‚´ì•„ë‚˜ëŠ” ì¤‘ (Day 3~4)")
            st.info("""
            **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
            ê°€ì¥ í˜ë“  ê³ ë¹„ëŠ” ë„˜ê²¼ì–´ìš”! í†µì¦ì€ ì¤„ì—ˆì§€ë§Œ, ëª¸ì— ìˆ˜ë¶„ì´ ë¹ ì ¸ë‚˜ê°€ì„œ **ì—„ì²­ ê±´ì¡°í•œ ìƒíƒœ**ì…ë‹ˆë‹¤.
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ë³´ê³ ] "ë¬¼! ë¬¼ì„ ì£¼ì„¸ìš”!"**
            * íŠ¸ëŸ¬ë¸”ì€ ê°€ë¼ì•‰ì•˜ì§€ë§Œ, ì–¼êµ´ì´ í‘¸ì„í‘¸ì„í•´ìš”.
            """)
            st.success("**âœ… ê¿€íŒ:** ìê·¹ ì—†ëŠ” **ìˆ˜ë¶„ ë§ˆìŠ¤í¬íŒ©** í•˜ë‚˜ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.")
            st.error("**âŒ ì£¼ì˜:** í™”ì¥ ëœ¬ë‹¤ê³  ê°ì§ˆ ì œê±°í•˜ë©´ ì–¼êµ´ ë’¤ì§‘ì–´ì ¸ìš”!")
            
            st.write("---")
            st.write(f"ğŸŒ™ ì €ë…: {make_routine(['í† ë„ˆ', 'ë§ˆìŠ¤í¬íŒ©(ìˆ˜ë¶„)', 'íˆì•Œë£¨ë¡ ì‚°', 'ë§ˆë°ì¹´+ì‹œì¹´(ë“¬ë¿)'])}")
            
        else: # Day 5
            st.markdown("#### ğŸŒ± 3ë‹¨ê³„: í™©ê¸ˆê¸° ì¤€ë¹„ (Day 5)")
            st.info("""
            **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
            ë“œë””ì–´ ëª¸ì´ ê°€ë²¼ì›Œì§€ê¸° ì‹œì‘í•©ë‹ˆë‹¤! ë‚´ì¼ë¶€í„° ì‹œì‘ë  **'í”¼ë¶€ ì „ì„±ê¸°'**ë¥¼ ìœ„í•´ ë¯¸ë¦¬ ì¤€ë¹„ìš´ë™ì„ í•˜ëŠ” ë‚ ì´ì—ìš”.
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ë³´ê³ ] "ê´‘ë‚¼ ì¤€ë¹„ ëìŠµë‹ˆë‹¤!"**
            * í˜ˆìƒ‰ì´ ëŒì•„ì˜¤ê³  í”¼ë¶€ ê²°ì´ ë§¤ë„ëŸ¬ì›Œì§€ê³  ìˆì–´ìš”.
            """)
            st.success("""
            **âœ… í•  ì¼:**
            * **ì‚´ì‚´ ì²­ì†Œ:** ë‚´ì¼ ë¹„ì‹¼ í™”ì¥í’ˆ ì˜ ë¨¹ìœ¼ë¼ê³ , ë¬µì€ ê°ì§ˆì„ ë¶€ë“œëŸ½ê²Œ(íš¨ì†Œ ì„¸ì•ˆì œ ë“±) ì œê±°í•´ì£¼ì„¸ìš”.
            * **ë¯¸ë°± ì‹œë™:** ë¹„íƒ€ë¯¼C ì•°í”Œ êº¼ë‚´ë‘ì„¸ìš”!
            """)
            st.write("---")
            st.write(f"ğŸŒ™ ì €ë…: {make_routine(['ğŸ“íš¨ì†ŒíŒŒìš°ë”(ê°ì§ˆì •ë¦¬)', 'í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'í¬ë¦¼'])}")

    # 2. ë‚œí¬ê¸° (Day 6 ~ 13)
    elif 6 <= day <= 13:
        st.success(f"### ğŸ“ˆ 2. ë‚œí¬ê¸°: í™©ê¸ˆê¸° & ë¦¬ì¦ˆ ê°±ì‹  (Day {day})")
        st.caption("ğŸ¢ í˜„ì¬ ìƒí™©: ì—ìŠ¤íŠ¸ë¡œê²(ë¯¸ëª¨ ë‹´ë‹¹)ì´ ì¶œê·¼í•´ì„œ ì§€ì›ê¸ˆì„ í‘í‘ ì“°ê³  ìˆì–´ìš”! âœ¨")
        
        st.info("""
        **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
        **í”¼ë¶€ì™€ ì»¨ë””ì…˜ì´ ìµœê³ ë¡œ ì¢‹ì€ ì‹œê¸°**ì…ë‹ˆë‹¤. íšŒë³µë ¥ì´ ë¹¨ë¼ì„œ ë­˜ í•´ë„ ì˜ ë¼ìš”.
        ë‹¤ì´ì–´íŠ¸, ì†Œê°œíŒ…, í”¼ë¶€ê³¼ ì‹œìˆ , ë¹„ì‹¼ í™”ì¥í’ˆ... ë‹¤ ì§€ê¸ˆ í•˜ì„¸ìš”!
        """)

        # ì¼ìë³„ ìƒì„¸ ë£¨í‹´ (Day 6~9)
        if day == 6:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ì¡°ëª… ì¼œê¸° (Day 6)")
            st.write("**ëª©í‘œ:** ì¹™ì¹™í–ˆë˜ ì–¼êµ´ì— ë¹„íƒ€ë¯¼ íˆ¬ì—¬! (ì¡í‹°/í†¤ì—…)")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'ğŸ“ë¹„íƒ€ë¯¼C ì•°í”Œ(ğŸ‹)', 'ë§ˆìŠ¤í¬íŒ©(ìˆ˜ë¶„)', 'ë§ˆë°ì¹´+ì‹œì¹´'])}")
            
        elif day == 7:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ê¹Šìˆ™ì´ ë„£ê¸° (Day 7)")
            st.write("**ëª©í‘œ:** ë·°í‹° ë””ë°”ì´ìŠ¤ê°€ ìˆë‹¤ë©´ ì˜¤ëŠ˜ì´ ê¸°íšŒì…ë‹ˆë‹¤. ì­‰ì­‰ ë°€ì–´ ë„£ìœ¼ì„¸ìš”.")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°(ë² ì´ìŠ¤)', 'ğŸ“ì´ˆìŒíŒŒê¸°ê¸° + ì•ŒíŒŒì•Œë¶€í‹´', 'í¬ë¦¼'])}")
            
        elif day == 8:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ê¸¸ ëš«ê¸° (Day 8)")
            st.write("**ëª©í‘œ:** íšŒë³µë ¥ì´ ì¢‹ì„ ë•Œë¼ 'ë‹ˆë“¤ìƒ·' ê°™ì€ ë”°ê°€ìš´ ì œí’ˆ ì“°ê¸° ë”± ì¢‹ìŠµë‹ˆë‹¤.")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ğŸ“ë‹ˆë“¤ìƒ·(ë§¨ì–¼êµ´)', 'í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'ì¬ìƒí¬ë¦¼'])}")
            st.error("âš ï¸ ì£¼ì˜: ë‹ˆë“¤ìƒ· í•œ ë‚ ì€ ë¹„íƒ€ë¯¼Cë‚˜ ë ˆí‹°ë†€ ê°™ì´ ìê·¹ì ì¸ ê±´ í”¼í•˜ì„¸ìš”! (ìˆ˜ë¶„/ì¬ìƒ ì˜¬ì¸)")
            
        elif day == 9:
            st.markdown("#### ğŸš€ 1ë‹¨ê³„: ê²° ì •ë¦¬ & ëª¨ê³µ (Day 9)")
            st.write("**ëª©í‘œ:** ì–´ì œ ëš«ì–´ë†“ì€ ê¸¸ë¡œ 'ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ'ë¥¼ ë„£ì–´ ëª¨ê³µì„ ìª¼ì—¬ì£¼ì„¸ìš”.")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'íˆì•Œë£¨ë¡ ì‚°', 'ğŸ“ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ', 'í¬ë¦¼'])}")
            
        else: # Day 10~13
            st.markdown("#### âœ¨ 2ë‹¨ê³„: ë¬¼ê´‘ ì½”íŒ… (Day 10~13)")
            st.write("**ğŸ‘‰ ì „ëµ:** ê³§ ë‹¤ê°€ì˜¬ ë°°ë€ê¸°(ê°œê¸°ë¦„)ì— ëŒ€ë¹„í•´ì„œ, **ìœ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤**ë¥¼ ë§ì¶°ë‘ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.")
            st.success("""
            **ğŸ’¡ ê¿€íŒ:**
            * **ì•°í”Œ ë¨¼ì €:** ë§ˆìŠ¤í¬íŒ© ë¶™ì´ê¸° ì „ì— ì•°í”Œì„ ë¨¼ì € ë°”ë¥´ë©´ íš¨ê³¼ê°€ 2ë°°!
            * **í¬ë¦¼ì€ ì ë‹¹íˆ:** 13ì¼ì¯¤ ë˜ë©´ í”¼ì§€ê°€ ìŠ¬ìŠ¬ ì˜¬ë¼ì˜¤ë‹ˆ í¬ë¦¼ ì–‘ì„ ì¡°ê¸ˆ ì¤„ì´ì„¸ìš”.
            """)
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'ğŸ’§íˆì•Œë£¨ë¡ ì‚°(íŒ© ì „)', 'ğŸ§–â€â™€ï¸ìˆ˜ë¶„ ë§ˆìŠ¤í¬íŒ©', 'ë§ˆë°ì¹´+ì‹œì¹´(ì–‡ê²Œ)'])}")

    # 3. ë°°ë€ê¸° & ì²´ì œ ì „í™˜ (Day 14 ~ 16)
    elif 14 <= day <= 16:
        st.warning(f"### ğŸ‰ 3. ë°°ë€ê¸°: í™”ë ¤í•œ íŒŒí‹° & í”¼ì§€ ì£¼ì˜ë³´ (Day {day})")
        
        if day == 14:
            st.caption("ğŸ¢ í˜„ì¬ ìƒí™©: ë‚œì(ì‹ ì œí’ˆ) ì¶œì‹œ íŒŒí‹° ì¤‘! í­ì£½ í„°ì§€ê³  ë‚œë¦¬ ë‚¬ì–´ìš”.")
            st.info("""
            **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
            ê°€ì¥ ë§¤ë ¥ì ì´ê³  ì˜ˆë» ë³´ì´ëŠ” ë‚ ì´ì§€ë§Œ, **í”¼ì§€(ê°œê¸°ë¦„)ê°€ í­ë°œ**í•˜ëŠ” ë‚ ì´ê¸°ë„ í•©ë‹ˆë‹¤.
            ê²‰ì€ ë²ˆë“¤ê±°ë¦¬ê³  ì†ì€ ë‹¹ê¸¸ ìˆ˜ ìˆì–´ìš”.
            """)
            st.markdown("#### ğŸš¨ ì˜¤ëŠ˜ ë¯¸ì…˜: ê°œê¸°ë¦„ ì²­ì†Œí•˜ê¸°")
            
            col1, col2 = st.columns(2)
            with col1:
                st.success("""
                **âœ… í•´ìš” (ë¹„ìš°ê¸°):**
                * **ë”¥ í´ë Œì§•:** ëª¨ê³µ ì†ê¹Œì§€ ê¼¼ê¼¼í•˜ê²Œ!
                * **ì¿¨ë§/ë¨¸ë“œíŒ©:** ì—´ ë‚´ë¦¬ê³  í”¼ì§€ ë¹¨ì•„ë“¤ì´ê¸°
                * **ìˆ˜ë¶„ ì ¤:** ê°€ë³ê³  ì‚°ëœ»í•˜ê²Œ ë§ˆë¬´ë¦¬
                """)
            with col2:
                st.error("""
                **âŒ ë§ˆìš” (ì°¸ê¸°):**
                * **ì˜¤ì¼/ì˜ì–‘í¬ë¦¼:** ì˜¤ëŠ˜ì€ ê¸°ë¦„ì§‘ë‹ˆë‹¤.
                * **ì§œì§€ ë§ˆì„¸ìš”:** í‰í„° ì˜¤ë˜ ë‚¨ì•„ìš”.
                * **ì¶©ë™êµ¬ë§¤:** ì§€ê°‘ ë‹«ìœ¼ì„¸ìš”!
                * **ì•¼ì‹:** ì‹ìš• í­ë°œ ì£¼ì˜!
                """)
            st.write("---")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ì˜¤ì¼í´ë Œì§•/íš¨ì†ŒíŒŒìš°ë”', 'ë‹¦ëŠ” í† ë„ˆ', 'ğŸ§Šëª¨ë¸ë§/ë¨¸ë“œíŒ©', 'ìˆ˜ë¶„ì ¤í¬ë¦¼'])}")
            
        else: # Day 15~16
            st.caption("ğŸ§¹ íŒŒí‹° ë! ì—´ ì‹íˆëŠ” ì¤‘")
            st.info("""
            **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
            ë°°ë€ì´ ëë‚˜ê³  **ëª¸ì´ ëœ¨ëˆëœ¨ëˆ**í•´ì§€ê¸° ì‹œì‘í•©ë‹ˆë‹¤. (ì²´ì˜¨ ìƒìŠ¹)
            ì—´ ë•Œë¬¸ì— ëª¨ê³µì´ ë„“ì–´ì§€ê³  í”¼ì§€ê°€ êµ³ì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì‹í˜€ì¤˜ì•¼ í•´ìš”.
            """)
            st.success("""
            **âœ… ê¿€íŒ:**
            * **ì¿¨ë§:** ì•Œë¡œì— ì ¤ì´ë‚˜ ì°¨ê°€ìš´ í† ë„ˆë¡œ ì–¼êµ´ ì˜¨ë„ë¥¼ ë‚®ì¶°ì£¼ì„¸ìš”.
            * **ì§„ì •:** ì‹œì¹´, í‹°íŠ¸ë¦¬, ì–´ì„±ì´ˆ ê°™ì€ ì§„ì • ì„±ë¶„ì´ ì¢‹ìŠµë‹ˆë‹¤.
            """)
            st.write("---")
            st.warning(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ì°¨ê°€ìš´ í† ë„ˆ', 'ìˆ˜ë¶„ ì•°í”Œ', 'ì•Œë¡œì— ì ¤(ë‘ê»ê²Œ)', 'ì‹œì¹´ í¬ë¦¼'])}")

    # 4. í™©ì²´ê¸° (Day 17 ~ 28)
    else:
        st.info(f"### ğŸ›¡ï¸ 4. í™©ì²´ê¸°: ë°©ì–´ ëª¨ë“œ & ì¡´ë²„ (Day {day})")
        st.caption("ğŸ‘®â€â™‚ï¸ í˜„ì¬ ìƒí™©: ë³´ì•ˆíŒ€ì¥ì´ ë¬¸ ì ê·¸ê³  ë¹„ìƒì‹ëŸ‰(ìˆ˜ë¶„, ì§€ë°©) ìŸì—¬ë‘ëŠ” ì¤‘.")
        
        st.markdown("""
        **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
        ëª¸ì´ ë¶“ê³ , ì‚´ì´ ì°Œê³ , ì˜ˆë¯¼í•´ì§€ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. (ë‚´ íƒ“ ì•„ë‹ˆì—ìš”!)
        ëª¸ë¬´ê²Œê°€ 1~2kg ëŠ˜ì–´ë‚  ìˆ˜ ìˆëŠ”ë°, ì§€ë°©ì´ ì•„ë‹ˆë¼ **ë¬¼(ë¶“ê¸°)**ì´ë‹ˆê¹Œ ë„ˆë¬´ ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì§€ ë§ˆì„¸ìš”.
        """)
        st.success("""
        **âœ… ìƒí™œ ìˆ˜ì¹™:**
        * **ì‹±ê²ê²Œ ë¨¹ê¸°:** ì§  ê±° ë¨¹ìœ¼ë©´ í’ì„ ì²˜ëŸ¼ ë¶€ì–´ìš”.
        * **ìˆœí™˜ ìš´ë™:** ë¦¼í”„ ë§ˆì‚¬ì§€, ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ë¶“ê¸° ë¹¼ì£¼ê¸°.
        * **ê²°ì • ë¯¸ë£¨ê¸°:** í‡´ì‚¬, ì´ë³„, ì•ë¨¸ë¦¬ ìë¥´ê¸°ëŠ” ë‹¤ìŒ ì£¼ì— ê²°ì •í•˜ì„¸ìš”. (ì§€ê¸ˆ ê¸°ë¶„ì€ ê°€ì§œ!)
        """)

        if day <= 22:
            st.markdown("#### ğŸ§± 1ë‹¨ê³„: í–‡ë¹› ë°©ì–´ (Day 17~22)")
            st.write("ê¸°ë¯¸, ì£¼ê·¼ê¹¨ê°€ ìƒê¸°ê¸° ë”± ì¢‹ì€ ë•Œì…ë‹ˆë‹¤.")
            st.warning("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ë³´ê³ ]**
            * **ìì™¸ì„  ì°¨ë‹¨ì œ**ë¥¼ í‰ì†Œë³´ë‹¤ ë‘ê»ê²Œ ë°”ë¥´ì„¸ìš”. (ì–‘ì‚°/ëª¨ì ì¶”ì²œ)
            * **í´ë ˆì´ íŒ©**ìœ¼ë¡œ ë§‰íŒ ëª¨ê³µì„ í•œ ë²ˆì”© ì²­ì†Œí•´ì£¼ì„¸ìš”.
            """)
            st.write("---")
            st.info(f"ğŸŒ™ ë£¨í‹´: {make_routine(['í† ë„ˆ', 'ì§„ì • ì•°í”Œ', 'ìˆ˜ë¶„ í¬ë¦¼', 'ëª¨ë¸ë§íŒ©(ì„ íƒ)'])}")
            
        else: # Day 23~28
            st.markdown("#### ğŸš¨ 2ë‹¨ê³„: í­ë™ ì „ì•¼ (ìƒë¦¬ ì „) (Day 23~28)")
            st.error("""
            **ğŸ’¬ í˜„ì‹¤ í•´ì„:**
            í˜¸ë¥´ëª¬ì´ ëš ë–¨ì–´ì§€ë©´ì„œ **ì§œì¦ì´ ë‚˜ê³  í”¼ë¶€ íŠ¸ëŸ¬ë¸”ì´ ì˜¬ë¼ì˜¤ëŠ”** ìµœì•…ì˜ ì‹œê¸°ì…ë‹ˆë‹¤.
            í„±ì´ë‚˜ ì… ì£¼ë³€ì— ë­ê°€ ë‚˜ë„ **ì ˆëŒ€ ê±´ë“œë¦¬ì§€ ë§ˆì„¸ìš”.**
            """)
            st.markdown("""
            **ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ê¸´ê¸‰ ì§€ì¹¨] "ì† ëŒ€ì§€ ë§ˆì‹œì˜¤!"**
            * í™”ì¥í’ˆ ê°œìˆ˜ë¥¼ í™• ì¤„ì´ì„¸ìš”. (í”¼ë¶€ ì²´í•¨)
            * ë¶‰ê²Œ ì˜¬ë¼ì˜¤ë©´ **íŠ¸ëŸ¬ë¸” íŒ¨ì¹˜**ë§Œ ë¶™ì´ê³  ê±°ìš¸ ë³´ì§€ ë§ˆì„¸ìš”.
            """)
            st.write("---")
            st.info(f"ğŸŒ™ ë£¨í‹´: {make_routine(['ì•½ì‚°ì„± ì„¸ì•ˆ', 'í† ë„ˆ', 'ì‹œì¹´ í¬ë¦¼(í•˜ë‚˜ë§Œ)', 'íŠ¸ëŸ¬ë¸”íŒ¨ì¹˜'])}")

    # ê³µí†µ í•˜ë‹¨ ë©”ì‹œì§€
    st.divider()
    st.caption("ğŸ’ª ì˜¤ëŠ˜ë„ ë‚´ ëª¸ ì£¼ì‹íšŒì‚¬ì˜ CEOë¡œì„œ íŒŒì´íŒ…í•˜ì„¸ìš”!")

# --- 3. ë©”ì¸ ì‹¤í–‰ í™”ë©´ ---
st.header("ğŸ“‘ ë‚´ ëª¸ ê²½ì˜ ì „ëµë³´ê³ ì„œ")

saved_date = load_date()

# ì‚¬ì´ë“œë°” ì„¤ì •
with st.sidebar:
    st.header("âš™ï¸ ì„¤ì • (CEO ì§‘ë¬´ì‹¤)")
    if saved_date:
        st.write(f"ğŸ“… ë§ˆì§€ë§‰ ëŒ€ì²­ì†Œ ì‹œì‘ì¼(ìƒë¦¬): `{saved_date}`")
    
    new_date = st.date_input("ë‚ ì§œ ìˆ˜ì •í•˜ê¸°", 
                             value=datetime.datetime.strptime(saved_date, "%Y-%m-%d").date() if saved_date else datetime.date.today())
    
    if st.button("ê²°ì¬(ì €ì¥)"):
        save_date(str(new_date))
        st.success("ìŠ¹ì¸ ì™„ë£Œ! ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.")
        st.rerun()

# ë©”ì¸ ë¡œì§ ì‹¤í–‰
if saved_date:
    current_day = calculate_cycle_day(saved_date)
    if current_day:
        display_hormone_guide(current_day)
    else:
        st.error("ì‹œìŠ¤í…œ ì˜¤ë¥˜: ë‚ ì§œ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.")
else:
    st.warning("ğŸ‘ˆ ì™¼ìª½ ë©”ë‰´ì—ì„œ ë§ˆì§€ë§‰ ìƒë¦¬ ì‹œì‘ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!")