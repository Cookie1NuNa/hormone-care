import streamlit as st
import datetime
import os

# --- 1. ê¸°ë³¸ ì„¤ì • ë° í•¨ìˆ˜ ---
DB_FILE = "last_period.txt"

def save_date(date_str):
    with open(DB_FILE, "w", encoding="utf-8") as f:
        f.write(date_str)

def load_date():
    if os.path.exists(DB_FILE):
        with open(DB_FILE, "r", encoding="utf-8") as f:
            return f.read().strip()
    return None

def make_routine(steps):
    return " â¡ï¸ ".join(steps)

def calculate_cycle_day(start_date_str):
    try:
        start_date = datetime.datetime.strptime(start_date_str, "%Y-%m-%d").date()
        today = datetime.date.today()
        delta = today - start_date
        return (delta.days % 28) + 1
    except:
        return None



def show_routine_list(title, color_style, routine_items):
    """
    ì„¸ë¡œí˜• ë£¨í‹´ì„ ì˜ˆì˜ê²Œ ì¶œë ¥í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
    - title: ì•„ì¹¨/ì €ë… ì œëª©
    - color_style: "success"(ì´ˆë¡), "info"(íŒŒë‘), "warning"(ë…¸ë‘), "error"(ë¹¨ê°•)
    - routine_items: {"ë‹¨ê³„ëª…": "ì œí’ˆëª…"} í˜•íƒœì˜ ë”•ì…”ë„ˆë¦¬
    """
    # ìƒ‰ìƒì— ë”°ë¥¸ ë°•ìŠ¤ ì„ íƒ
    box_func = getattr(st, color_style) 
    
    with box_func(title): # ë°•ìŠ¤ ì•ˆì— ë‚´ìš© í‘œì‹œ
        for step, product in routine_items.items():
            st.markdown(f"**{step}:** {product}")



# --- 2. [í•µì‹¬] ë‚´ ëª¸ ì£¼ì‹íšŒì‚¬ ê°€ì´ë“œ (ì¹œì ˆí•œ ë²„ì „) ---
def display_hormone_guide(day):
    # 0. ì§„í–‰ë¥  í‘œì‹œ
    progress_val = min(day / 28, 1.0)
    st.progress(progress_val, text=f"í˜„ì¬ {day}ì¼ì°¨ ({int(progress_val*100)}%) ì§„í–‰ ì¤‘")

    st.divider()
    st.markdown(f"#### ğŸ§¸ ì˜¤ëŠ˜ì˜ ë³´ê³ ì„œ: **Day {day}**")
    
    # -----------------------------------------------------------
    # [1] ì•„ì¹¨ ì„¸ì•ˆë²• ê²°ì •
    # -----------------------------------------------------------
    skin_condition = st.selectbox(
        "ğŸ‘‡ ì˜¤ëŠ˜ ì•„ì¹¨ í”¼ë¶€ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”? (ì„¸ì•ˆë²• ê²°ì •)",
        ["CASE 1. í‰ì†Œ/ê±´ì¡°í•¨ (ë‹¹ê¹€)", "CASE 2. Tì¡´ ë²ˆë“¤ê±°ë¦¼ (ìƒë¦¬ì „/ë°°ë€ê¸°)", "CASE 3. ì–´ì œ ë¬´ê±°ìš´ íŒ© í•¨ (ì”ì—¬ë¬¼)"]
    )

    # ì„¸ì•ˆì œ ë³€ìˆ˜ ì„¤ì •
    if "CASE 1" in skin_condition:
        cleanser = "ğŸ’¦ë¬¼ì„¸ì•ˆ(ê°€ë³ê²Œ)"
    else:
        cleanser = "â˜ï¸ì•½ì‚°ì„± í¼(ì†ŒëŸ‰)"

    # [ê³µí†µ] ì•„ì¹¨ ë£¨í‹´ ë”•ì…”ë„ˆë¦¬ ìƒì„± (ë§¤ë²ˆ ë§Œë“¤ê¸° ê·€ì°®ìœ¼ë‹ˆ ì—¬ê¸°ì„œ ì •ì˜)
    morning_routine = {
        "ì„¸ì•ˆ": cleanser,
        "ì•°í”Œ": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
        "ë³´ìŠµ": "í”„ë¦¬ë©”ì´ ìˆ˜ë¶„í¬ë¦¼",
        "ë°©ì–´": "ğŸ§´ì„ í¬ë¦¼(ê¼¼ê¼¼íˆ!)"
    }

    # ===========================================================
    # [2] ì£¼ê¸°ë³„ ë£¨í‹´ ì¶œë ¥ (ì „ì²´ ìˆ˜ì •ë¨)
    # ===========================================================

    # -------------------------------
    # ğŸ©¸ 1. ìƒë¦¬ê¸° (Day 1 ~ 5)
    # -------------------------------
    if 1 <= day <= 5:
        st.error(f"### ğŸ©¸ 1. ìƒë¦¬ê¸°: ëŒ€ì²­ì†Œ & íœ´ì‹ ê¸°ê°„ (Day {day})")
        
        # Day 1 ~ 2
        if day <= 2:
            st.markdown("#### ğŸš¨ 1ë‹¨ê³„: í­í’ì˜ ì‹œì‘ (Day 1~2)")
            st.markdown("""
                        âš ï¸ ì£¼ì˜: í”¼ë¶€ ì¥ë²½ì´ ê°€ì¥ ì•½í•  ë•Œì…ë‹ˆë‹¤. ì†ì— í˜ì„ ì«™ ë¹¼ì„¸ìš”.
                        í™”ì¥í’ˆì„ ë°”ë¥¼ ë•Œ ë¬¸ì§€ë¥´ê¸°ë³´ë‹¤ 'ì§€ê·¸ì‹œ ëˆ„ë¥´ë“¯' í¡ìˆ˜ì‹œí‚¤ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.
                        """)
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
                    "ì§„ì •": "ğŸŒ¿ ë§ˆë°ì¹´/ì‹œì¹´ë°¤ (ë“¬ë¿)"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ì§„ì •)", "info", night_routine)
            
        # Day 3 ~ 4
        elif day <= 4:
            st.markdown("#### ğŸ§¹ 2ë‹¨ê³„: ì¡°ê¸ˆì”© ì‚´ì•„ë‚˜ëŠ” ì¤‘ (Day 3~4)")
            st.markdown("""âš ï¸ ì£¼ì˜: ë§ˆìŠ¤í¬íŒ©ì€ ì ˆëŒ€ 15ë¶„ì„ ë„˜ê¸°ì§€ ë§ˆì„¸ìš”. 
                        íŒ©ì´ ë§ˆë¥´ê¸° ì‹œì‘í•˜ë©´ ì˜¤íˆë ¤ í”¼ë¶€ ìˆ˜ë¶„ì„ ëºì–´ê°‘ë‹ˆë‹¤.
                        (ë–¼ì–´ë‚¸ í›„ í¬ë¦¼ìœ¼ë¡œ ê°€ë‘ê¸° í•„ìˆ˜!)
                        """)
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ìŠ¤í˜ì…œ": "ğŸ§–â€â™€ï¸ìˆ˜ë¶„ ë§ˆìŠ¤í¬íŒ©",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
                    "ì ê¸ˆ": "ğŸ›¡ï¸ë§ˆë°ì¹´/ì‹œì¹´ë°¤"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ìˆ˜ë¶„)", "info", night_routine)

        # Day 5
        else: 
            st.markdown("#### ğŸŒ± 3ë‹¨ê³„: í™©ê¸ˆê¸° ì¤€ë¹„ (Day 5)")
            st.markdown("ë¬µì€ ê°ì§ˆì„ ì‚´ì‚´ ì²­ì†Œí•˜ê³ , ë¯¸ë°± ì•°í”Œ ì¤€ë¹„!")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ë”¥í´ë Œì§•": "ğŸ“íš¨ì†ŒíŒŒìš°ë”",
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
                    "ì§„ì •": "ğŸ›¡ï¸ë§ˆë°ì¹´/ì‹œì¹´ë°¤"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ê°ì§ˆì œê±°)", "info", night_routine)

    # -------------------------------
    # ğŸ“ˆ 2. ë‚œí¬ê¸° (Day 6 ~ 13)
    # -------------------------------
    elif 6 <= day <= 13:
        st.success(f"### ğŸ“ˆ 2. ë‚œí¬ê¸°: í™©ê¸ˆê¸° & ë¦¬ì¦ˆ ê°±ì‹  (Day {day})")

        # Day 6
        if day == 6:
            st.markdown("#### ğŸš€ Day 6: ë¹„íƒ€ë¯¼C (ì¡í‹° ì™„í™”)")
            st.write("""âš ï¸ ì£¼ì˜: ë¹„íƒ€ë¯¼CëŠ” ë”°ê°€ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
                     ë°”ë¥¸ ì§í›„ ìì™¸ì„  ë…¸ì¶œ ê¸ˆì§€ (ì €ë…ì´ë¼ ê´œì°®ì§€ë§Œ í˜•ê´‘ë“± ë°”ë¡œ ì•„ë˜ë„ í”¼í•˜ë©´ ì¢‹ì•„ìš”).
                     """)
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ë¯¸ë°±": "ğŸ‹ì½”ìŠ¤ì•Œì—‘ìŠ¤ ë¹„íƒ€ë¯¼C",
                    "ì§„ì •íŒ©": "ğŸ§–â€â™€ï¸í† ë¦¬ë“  ë§ˆìŠ¤í¬íŒ©",
                    "ë§ˆë¬´ë¦¬": "ğŸ›¡ï¸ë§ˆë°ì¹´/ì‹œì¹´ë°¤"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ë¯¸ë°±)", "warning", night_routine)

        # Day 7
        elif day == 7:
            st.markdown("#### ğŸš€ Day 7: ì•Œë¶€í‹´ + ê¸°ê¸° (í†¤ ì •ë¦¬)")
            st.write("""âš ï¸ ì£¼ì˜: ê¸°ê¸° ì‚¬ìš© ì‹œ ì•°í”Œì„ í‰ì†Œë³´ë‹¤ 1.5ë°° ë“¬ë¿ ë°”ë¥´ì„¸ìš”.
                     ë§ˆì°°ì´ ìƒê¸°ë©´ ìƒ‰ì†Œì¹¨ì°©ì´ ë” ì‹¬í•´ì§‘ë‹ˆë‹¤.
                    """)
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°(ë“¬ë¿!)",
                    "ê¸°ê¸°ê´€ë¦¬": "ğŸ’¡ì•Œë¶€í‹´ ì•°í”Œ + ë””ë°”ì´ìŠ¤",
                    "ë§ˆë¬´ë¦¬": "ğŸ›¡ï¸ë§ˆë°ì¹´/ì‹œì¹´ë°¤"
                }
                show_routine_list("ğŸŒ™ ì €ë… (í¡ìˆ˜)", "warning", night_routine)

        # Day 8
        elif day == 8:
            st.markdown("#### ğŸš€ Day 8: ë¦¬ë“¤ìƒ· 300 (ê¸¸ ëš«ê¸°)")
            st.write("**ëª©í‘œ:** íšŒë³µë ¥ì´ ì¢‹ì„ ë•Œë¼ ë”°ê°€ìš´ ë‹ˆë“¤ìƒ· ì“°ê¸° ë”± ì¢‹ìŠµë‹ˆë‹¤. (ë¹„íƒ€ë¯¼ ê¸ˆì§€)")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ë¶€ìŠ¤íŒ…": "âš¡VT ë¦¬ë“¤ìƒ·(ë§¨ì–¼êµ´,ê¾¹ê¾¹ì´)",
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
                    "ì§„ì •": "ğŸ›¡ï¸ì‹œì¹´ë°¤(2ë°°ë¡œ ë³´ìŠµí­íƒ„!)"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ëª¨ê³µ)", "warning", night_routine)

        # Day 9
        elif day == 9:
            st.markdown("#### ğŸš€ Day 9: ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ (ëª¨ê³µ ì«€ì«€)")
            st.write("**ëª©í‘œ:** ê±´ì¡°í•˜ì§€ ì•Šê²Œ ëª¨ê³µ ê´€ë¦¬í•˜ê¸°. (í¬ë¦¼ì— ì„ì–´ì„œ!)")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
                    "ëª¨ê³µì¼€ì–´": "ğŸ§´í¬ë¦¼3 + ë‚˜ì´ì•„ì‹ 1 ë¯¹ìŠ¤",
                    "ë³´ìŠµë§‰": "í¬ë¦¼ í•œê²¹ ë”"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ëª¨ê³µ)", "warning", night_routine)

        # Day 10~13
        else:
            st.markdown("#### âœ¨ 2ë‹¨ê³„: ë¬¼ê´‘ ì½”íŒ… (Day 10~13)")
            st.write("**ğŸ‘‰ ì „ëµ:** ë°°ë€ê¸°(ê°œê¸°ë¦„) ëŒ€ë¹„ ìœ ìˆ˜ë¶„ ë°¸ëŸ°ìŠ¤ ë§ì¶”ê¸°.")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
                    "ìˆ˜ë¶„íŒ©": "ğŸ§–â€â™€ï¸ìˆ˜ë¶„ ë§ˆìŠ¤í¬íŒ©",
                    "ë§ˆë¬´ë¦¬": "ğŸ›¡ï¸ë§ˆë°ì¹´ í¬ë¦¼"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ë¬¼ê´‘)", "warning", night_routine)

    # -------------------------------
    # ğŸ‰ 3. ë°°ë€ê¸° (Day 14 ~ 16)
    # -------------------------------
    elif 14 <= day <= 16:
        st.warning(f"### ğŸ‰ 3. ë°°ë€ê¸°: í™”ë ¤í•œ íŒŒí‹° & í”¼ì§€ ì£¼ì˜ë³´ (Day {day})")
        
        # Day 14
        if day == 14:
            st.caption("ğŸ¢ í˜„ì¬ ìƒí™©: ë‚œì ì¶œì‹œ íŒŒí‹° ì¤‘! í­ì£½ í„°ì§€ê³  ë‚œë¦¬ ë‚¬ì–´ìš”.")
            st.markdown("#### ğŸš¨ ì˜¤ëŠ˜ ë¯¸ì…˜: ê°œê¸°ë¦„ ì²­ì†Œ & ì—´ ë‚´ë¦¬ê¸°")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ë”¥í´ë Œì§•": "ì˜¤ì¼í´ë Œì§•(ì½” ì§‘ì¤‘)",
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ì¿¨ë§íŒ©": "ğŸ§Ší† ë¦¬ë“  ë§ˆìŠ¤í¬íŒ©(ì°¨ê°‘ê²Œ-!!)",
                    "ë§ˆë¬´ë¦¬": "í”„ë¦¬ë©”ì´ ìˆ˜ë¶„í¬ë¦¼"
                }
                show_routine_list("ğŸŒ™ ì €ë… (í”¼ì§€ì¡°ì ˆ)", "warning", night_routine)

        # Day 15~16
        else:
            st.caption("ğŸ§¹ íŒŒí‹° ë! ì—´ ì‹íˆëŠ” ì¤‘")
            st.success("âœ… **ì¶”ì²œ:** ì•Œë¡œì— ì ¤ì´ë‚˜ ì°¨ê°€ìš´ í† ë„ˆë¡œ ì–¼êµ´ ì˜¨ë„ ë‚®ì¶”ê¸°")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ì¿¨ë§": "ğŸ§Šì°¨ê°€ìš´ í† ë„ˆ(ë‹¥í† )",
                    "ìˆ˜ë¶„": "ğŸ’§ë””ì˜¤ë””ë„ˆë¦¬ íˆì•Œë£¨ë¡ ì‚°",
                    "ì§„ì •": "í”„ë¦¬ë©”ì´",
                    "ë§ˆë¬´ë¦¬": "ğŸ›¡ï¸ì‹œì¹´ë°¤(ì–‡ê²Œ)"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ì¿¨ë§)", "warning", night_routine)

    # -------------------------------
    # ğŸ›¡ï¸ 4. í™©ì²´ê¸° (Day 17 ~ 28)
    # -------------------------------
    else:
        st.info(f"### ğŸ›¡ï¸ 4. í™©ì²´ê¸°: ë°©ì–´ ëª¨ë“œ & ì¡´ë²„ (Day {day})")
        st.caption("íŠ¸ëŸ¬ë¸”ì ë³µê¸°-ìœ ìˆ˜ë¶„ë°¸ëŸ¬ìŠ¤ ë§ì¶”ê¸°!")

        # Day 17~22
        if day <= 22:
            st.markdown("#### ğŸ§± 1ë‹¨ê³„: í–‡ë¹› & ê±´ì¡° ë°©ì–´ (Day 17~22)")
            st.markdown("""âš ï¸ ì£¼ì˜: ì†ì€ ê±´ì¡°í•˜ê³  ê²‰ì€ ë²ˆë“¤ê±°ë¦¬ê¸° ì‹œì‘í•©ë‹ˆë‹¤.
                        í¬ë¦¼ ì–‘ì„ ëŠ˜ë¦¬ê¸°ë³´ë‹¤ íˆì•Œë£¨ë¡ ì‚°(ìˆ˜ë¶„)ì„ ë‘ ë²ˆ ë ˆì´ì–´ë§ í•˜ëŠ” ê²Œ ë‚«ìŠµë‹ˆë‹¤.""")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ì§‘ì¤‘ì¼€ì–´": "ğŸ’§íˆì•Œë£¨ë¡ ì‚°(2ë²ˆ) + ë””ë°”ì´ìŠ¤",
                    "ê³ ë³´ìŠµ": "ğŸ›¡ï¸ë§ˆë°ì¹´/ì„¸íƒ€í•„"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ë³´ìŠµì €ì¥)", "info", night_routine)

        # Day 23~28
        else:
            st.markdown("#### ğŸš¨ 2ë‹¨ê³„: í­ë™ ì „ì•¼ (ìƒë¦¬ ì „) (Day 23~28)")
            st.markdown("**ğŸ§–â€â™€ï¸ [í”¼ë¶€íŒ€ ê¸´ê¸‰ ì§€ì¹¨]** í™”ì¥í’ˆ ë‹¤ì´ì–´íŠ¸! íŠ¸ëŸ¬ë¸” ë‚˜ë©´ íŒ¨ì¹˜ë§Œ.")
            
            col1, col2 = st.columns(2)
            with col1:
                show_routine_list("â˜€ï¸ ì•„ì¹¨", "success", morning_routine)
            with col2:
                night_routine = {
                    "ì„¸ì•ˆ": "â˜ï¸ ì•½ì‚°ì„± ì„¸ì•ˆ",
                    "ê²°ì •ëˆ": "â˜ï¸ í† ë„ˆ",
                    "ì§„ì •": "ğŸ›¡ï¸ì‹œì¹´ë°¤(ë‘ê»ê²Œ)",
                    "SOS": "íŠ¸ëŸ¬ë¸”íŒ¨ì¹˜"
                }
                show_routine_list("ğŸŒ™ ì €ë… (ìµœì†Œí™”)", "error", night_routine)

    
    # ê³µí†µ í•˜ë‹¨ ë©”ì‹œì§€
    st.divider()
    st.caption("ğŸ’ª ë”± 10ë¶„ íˆ¬ì, 10ë…„ ìœ ì§€. ì •ì„±ìŠ¤ëŸ½ê²Œ-")

# --- 3. ë©”ì¸ ì‹¤í–‰ í™”ë©´ ---

saved_date = load_date()

# ì‚¬ì´ë“œë°” ì„¤ì • ë¶€ë¶„
# --- [ìˆ˜ì •] ì‚¬ì´ë“œë°” ì„¤ì • ë¶€ë¶„ ---
with st.sidebar:
    st.header("âš™ï¸ ì„¤ì • (My Room)")
    
    # 1. ë‚ ì§œ ì„¤ì •
    if saved_date:
        st.write(f"ğŸ“… ë§ˆì§€ë§‰ ìƒë¦¬ ì‹œì‘ì¼: `{saved_date}`")
    
    new_date = st.date_input("ë‚ ì§œ ìˆ˜ì •í•˜ê¸°", 
                             value=datetime.datetime.strptime(saved_date, "%Y-%m-%d").date() if saved_date else datetime.date.today())
    
    if st.button("ë‚ ì§œ ì €ì¥"):
        save_date(str(new_date))
        st.success("ì €ì¥ ì™„ë£Œ! ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.")
        st.rerun()

    st.divider() # êµ¬ë¶„ì„ 

    # 2. [ì¶”ê°€ë¨] ë””ë°”ì´ìŠ¤ ìŠ¤ì¼€ì¤„ (ì ‘ì´ì‹ ë©”ë‰´)
    st.subheader("ğŸ—“ï¸ ë””ë°”ì´ìŠ¤ ê²°ì¬íŒ")
    
    # expanded=Falseë¡œ í•˜ë©´ ì²˜ìŒì— ì ‘í˜€ìˆì–´ì„œ ê¹”ë”í•©ë‹ˆë‹¤.
    with st.expander("ğŸ“¡ ì´ˆìŒíŒŒ ëª¨ë“œ ì›”ê°„ ê³„íší‘œ (Click)", expanded=False):
        st.markdown("""
        **1ì£¼ì°¨ (Day 1~5) : ìƒë¦¬ê¸°**
        > â›” **[íœ´ì—…]**
        
        **2ì£¼ì°¨ (Day 6~13) : ë‚œí¬ê¸°**
        > âœ… **[í™©ê¸ˆê¸°]** >**íƒ„ë ¥ ê°œì„  íš¨ê³¼**
        
        **3ì£¼ì°¨ (Day 14~20) : ë°°ë€~í™©ì²´**
        > ğŸ’†â€â™€ï¸ **[ì§‘ì¤‘ ê´€ë¦¬]** > **ì˜ì–‘ ê³µê¸‰**
        
        **4ì£¼ì°¨ (Day 21~28) : ìƒë¦¬ ì „**
        > âš ï¸ **[ì¡°ê±´ë¶€]** > íŠ¸ëŸ¬ë¸”ì´ ì˜¬ë¼ì˜¤ë©´ **PASS**, ê´œì°®ìœ¼ë©´ ê°€ë³ê²Œ ì§„í–‰í•©ë‹ˆë‹¤. (0~1íšŒ)
        """)
        
    st.caption("â€» ì´ˆìŒíŒŒëŠ” ì£¼ 1íšŒ ê¶Œì¥")

# ë©”ì¸ ë¡œì§ ì‹¤í–‰
if saved_date:
    current_day = calculate_cycle_day(saved_date)
    
    
    if current_day:
        display_hormone_guide(current_day) # ì˜¤ëŠ˜ì˜ ë¦¬í¬íŠ¸
    else:
        st.error("ì‹œìŠ¤í…œ ì˜¤ë¥˜: ë‚ ì§œ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.")
else:
    st.warning("ğŸ‘ˆ ì™¼ìª½ ë©”ë‰´ì—ì„œ 'ë§ˆì§€ë§‰ ìƒë¦¬ ì‹œì‘ì¼'ì„ ì…ë ¥í•˜ê³  ì €ì¥ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!")